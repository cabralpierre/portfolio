if (self.CavalryLogger) { CavalryLogger.start_js(["rNU6g"]); }

__d("NotificationSubscriptions",["invariant","Arbiter","Bootloader","ChannelConstants","JSLogger","NotificationConstants","NotificationTokens","NotificationUpdates","SubscriptionsHandler","createObjectFrom"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=null,j=null,k=0;function l(){if(i==null)i=c("JSLogger").create("notification_updates");return i}function m(){for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];c("Bootloader").loadModules(["NotificationSeenState","NotificationStore"],function(){c("NotificationUpdates").handleUpdate.apply(c("NotificationUpdates"),t)},"NotificationSubscriptions")}function n(){return c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("notification_json"),function(s,t){var u=Date.now(),v=t.obj.nodes;if(v){v.forEach(function(x){x.receivedTime=u});l().debug("notifications_received",v);var w=t.obj.servertime;m(c("NotificationConstants").PayloadSourceType.LIVE_SEND,{nodes:v,servertime:w})}})}function o(){return c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("notifications_seen"),function(s,t){var u=c("NotificationTokens").tokenizeIDs(t.obj.alert_ids),v=t.obj.new_state;m(c("NotificationConstants").PayloadSourceType.LIVE_SEND,{seenState:c("createObjectFrom")(u,v)})})}function p(){return c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("notifications_read"),function(s,t){var u=c("NotificationTokens").tokenizeIDs(t.obj.alert_ids),v=t.obj.new_state;m(c("NotificationConstants").PayloadSourceType.LIVE_SEND,{readState:c("createObjectFrom")(u,v)})})}function q(){return c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("notification_hidden"),function(s,t){var u=c("NotificationTokens").tokenizeIDs([t.obj.notif_id+""]),v=t.obj.state===1;m(c("NotificationConstants").PayloadSourceType.LIVE_SEND,{hiddenState:c("createObjectFrom")(u,v)})})}var r={setup:function s(){__p&&__p();k++;if(j==null){j=new(c("SubscriptionsHandler"))();j.addSubscriptions(q(),p(),o(),n())}var t=false;return{remove:function u(){if(t===true)return;j!=null||h(0);t=true;k--;if(k===0){j.release();j=null}}}}};f.exports=r}),null);