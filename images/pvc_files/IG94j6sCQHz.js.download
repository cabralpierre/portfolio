if (self.CavalryLogger) { CavalryLogger.start_js(["7R3PN"]); }

__d("ContentSearchEvents",[],(function a(b,c,d,e,f,g){f.exports={CONTENT_SEARCH:"content_search",OPEN_TRAY:"open_tray",QUERY_RESULTS_LOADED:"query_results_loaded",RESULT_SENT:"result_sent",namesByValue:{content_search:"CONTENT_SEARCH",open_tray:"OPEN_TRAY",query_results_loaded:"QUERY_RESULTS_LOADED",result_sent:"RESULT_SENT"}}}),null);
__d("MessengerPlatformQueryType",[],(function a(b,c,d,e,f,g){f.exports={SEARCH:0,MEDIAFY:1,TRENDING:2,SAMPLE:3,namesByValue:["SEARCH","MEDIAFY","TRENDING","SAMPLE"]}}),null);
__d("XMessengerPlatformContentSearchController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/content_search/",{q:{type:"String",defaultValue:""},qtype:{type:"Enum",defaultValue:0,enumType:0},resume:{type:"String",defaultValue:""},"interface":{type:"Enum",enumType:0}})}),null);
__d("ChatContentSearch",["AsyncRequest","MessengerPlatformQueryType","XMessengerPlatformContentSearchController"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={getContentForQuery:function i(j){var k=j.query,l=j.callback,m=j.resume,n=j.searchInterface,o=c("XMessengerPlatformContentSearchController").getURIBuilder().setString("q",k).setString("resume",m);if(n!=null)o.setEnum("interface",n);var p=new(c("AsyncRequest"))().setURI(o.getURI()).setHandler(l);p.send();return p},getTrending:function i(j,k,l){var m=c("XMessengerPlatformContentSearchController").getURIBuilder().setEnum("qtype",c("MessengerPlatformQueryType").TRENDING).setString("resume",k);if(l!=null)m.setEnum("interface",l);var n=new(c("AsyncRequest"))().setURI(m.getURI()).setHandler(j);n.send();return n}};f.exports=h}),null);
__d("ChatContentSearchResult.react",["cx","Image.react","Keys","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l=274,m=137;i=babelHelpers.inherits(n,c("React").PureComponent);j=i&&i.prototype;function n(){__p&&__p();var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=j.constructor).call.apply(o,[this].concat(r)),this.$ChatContentSearchResult1=function(t){t.stopPropagation();this.props.onClick(this.props.result)}.bind(this),this.$ChatContentSearchResult2=function(t){if(t.keyCode===c("Keys").RETURN){t.preventDefault();this.props.onClick(this.props.result)}}.bind(this),p}n.isWide=function(o){var p=o.media.preview;return p.width>p.height*1.2};n.getScaledDimensions=function(o,p){var q=o.media.preview,r=q.height,s=q.width,t=(p?l:m)/s;r*=t;s*=t;return{height:r,width:s}};n.prototype.render=function(){var o=n.getScaledDimensions(this.props.result,this.props.isWide);return c("React").createElement(c("Image.react"),{className:"_358"+(this.props.isWide?" _26n6":""),onClick:this.$ChatContentSearchResult1,onKeyDown:this.$ChatContentSearchResult2,src:this.props.src,style:o,tabIndex:"0"})};n.propTypes={isWide:k.bool.isRequired,onClick:k.func.isRequired,result:k.object.isRequired,src:k.string.isRequired};f.exports=n}),null);
__d("ChatContentSearchResults.react",["ChatContentSearch","ChatContentSearchResult.react","MercuryConfig","MessengerPlatformInterfaceType","MessengerSpinner.react","ReactComponentWithPureRenderMixin","React","ScrollableArea.react","debounce","emptyFunction"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("React").PropTypes,i={};function j(l){return l.replace(/^httpss/,"https")}var k=c("React").createClass({displayName:"ChatContentSearchResults",_inflightRequest:undefined,_requestResults:c("emptyFunction"),_reset:c("emptyFunction"),_inflightTimeStart:undefined,mixins:[c("ReactComponentWithPureRenderMixin")],propTypes:{onResultsLoaded:h.func,onSelect:h.func.isRequired,query:h.string.isRequired,searchInterface:h.oneOf([c("MessengerPlatformInterfaceType").UNKNOWN_INTERFACE,c("MessengerPlatformInterfaceType").FB_INTERFACE,c("MessengerPlatformInterfaceType").MESSENGER_INTERFACE,c("MessengerPlatformInterfaceType").FB_POST_INTERFACE])},getInitialState:function l(){return{isLoading:false,response:null,results:[]}},componentDidMount:function l(){this._reset=c("debounce")(this._resetImpl,100);this._requestResults=c("debounce")(this._requestResultsImpl,200);this._requestResults()},componentWillUnmount:function l(){this._cancelInflightRequest()},componentWillReceiveProps:function l(m){if(m.query!==this.props.query)this._reset(this._requestResultsImpl)},render:function l(){return c("React").createElement(c("ScrollableArea.react"),{fade:true,onScroll:this._handleScroll,ref:"scrollable"},this._renderResults(),this._renderLoadingIndicator())},_renderLoadingIndicator:function l(){if(!this.state.isLoading)return null;return c("React").createElement("div",{style:{marginTop:this.state.response?"10px":"140px",textAlign:"center"}},c("React").createElement(c("MessengerSpinner.react"),{color:"grey",size:c("MessengerSpinner.react").medium_size}))},_requestResultsImpl:function l(){__p&&__p();this._cancelInflightRequest();this._inflightTimeStart=Date.now();if(this.state.response&&(!this.state.response.resultNextCursor||!this.props.query))return;var m=void 0;this.setState({isLoading:true});if(this.props.query)m=c("ChatContentSearch").getContentForQuery({query:this.props.query,resume:this.state.response?this.state.response.resultNextCursor:undefined,callback:this._handleAsyncResponse,searchInterface:this.props.searchInterface});else m=c("ChatContentSearch").getTrending(this._handleAsyncResponse,this.state.response?this.state.response.resultNextCursor:undefined,this.props.searchInterface);this._inflightRequest=m},_handleAsyncResponse:function l(m){__p&&__p();if(this._inflightRequest===m.request){i=babelHelpers["extends"]({},i,m.payload.attribution);this.setState({isLoading:false,response:m.payload,results:m.payload.resultGroup[0]?this.state.results.concat(m.payload.resultGroup[0].results):this.state.results},function(){if(this._inflightTimeStart){if(this.props.onResultsLoaded)this.props.onResultsLoaded(Date.now()-this._inflightTimeStart);delete this._inflightTimeStart}}.bind(this));delete this._inflightRequest}},_cancelInflightRequest:function l(){this.setState({isLoading:false});if(this._inflightRequest){this._inflightRequest.abort();delete this._inflightRequest;delete this._inflightTimeStart}},_renderResults:function l(){if(!this.state.response||!this.state.results.length)return null;return this.state.results.map(function(m,n){var o=c("ChatContentSearchResult.react").isWide(m);if(!o&&m.platformFBID.toString()!==c("MercuryConfig").MessengerAppID){var p=n-this._getPrevWideIndex(n),q=this._getNextWideIndex(n)-n;o=(p<=1||p%2!==0)&&q<=1}return c("React").createElement(c("ChatContentSearchResult.react"),{isWide:o,key:"result:"+n+":"+m.resultID,onClick:this._handleResultClick,result:m,src:j(m.media.preview.url)})}.bind(this))},_getPrevWideIndex:function l(m){while(m>0){--m;if(c("ChatContentSearchResult.react").isWide(this.state.results[m]))return m}return m},_getNextWideIndex:function l(m){var n=this.state.results.length;while(m<n-1){++m;if(c("ChatContentSearchResult.react").isWide(this.state.results[m]))return m}return m},_handleResultClick:function l(m){this.props.onSelect(m,i[m.platformFBID])},_handleScroll:function l(){if(this._isScrolledNearBottom()&&!this._inflightRequest)this._requestResults()},_isScrolledNearBottom:function l(){var m=this.refs.scrollable.getArea();return!!(m&&m.distanceToBottom()<=50)},_resetImpl:function l(m){this.setState(this.getInitialState(),m)}});f.exports=k}),null);
__d("ChatContentSearchTrendingIndicator.react",["cx","fbt","ix","Image.react","React"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l;k=babelHelpers.inherits(m,c("React").Component);l=k&&k.prototype;function m(n){l.constructor.call(this,n)}m.prototype.shouldComponentUpdate=function(n){return n.shown!==this.props.shown};m.prototype.render=function(){return this.props.shown?c("React").createElement("div",{className:"_515"},c("React").createElement(c("Image.react"),{src:j("28005")}),i._("Trending")):null};f.exports=m}),null);
__d("ChatContentSearchFlyout.react",["cx","fbt","BanzaiLogger","ContentSearchEvents","ChatContentSearchResults.react","ChatContentSearchTrendingIndicator.react","Keys","MessengerPlatformInterfaceType","MessengerSearchInput.react","React","ReactDOM","MercuryShareAttachmentRenderLocations","XUITextInput.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes,m=" ",n=/\s+/g;j=babelHelpers.inherits(o,c("React").PureComponent);k=j&&j.prototype;function o(){__p&&__p();var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=k.constructor).call.apply(p,[this].concat(s)),this.state={query:this.props.query,viewerEnteredText:false},this.$ChatContentSearchFlyout6=function(u){this.setState({query:u.target.value,viewerEnteredText:u.target.value.length>0})}.bind(this),this.$ChatContentSearchFlyout1=function(u){return(u||"").trim().replace(n,m).toLowerCase()},this.$ChatContentSearchFlyout2=function(u){if(u.keyCode===c("Keys").ESC&&this.props.onEscKeyDown)this.props.onEscKeyDown()}.bind(this),this.$ChatContentSearchFlyout5=function(u,v){this.props.onSelect(u,v);c("BanzaiLogger").log("ContentSearchLoggerConfig",{event:c("ContentSearchEvents").RESULT_SENT,query:this.state.query,resultid:u.resultID})}.bind(this),this.$ChatContentSearchFlyout4=function(u){c("BanzaiLogger").log("ContentSearchLoggerConfig",{event:c("ContentSearchEvents").QUERY_RESULTS_LOADED,query:this.state.query,inflighttime:u})}.bind(this),q}o.prototype.componentDidMount=function(){c("BanzaiLogger").log("ContentSearchLoggerConfig",{event:c("ContentSearchEvents").OPEN_TRAY,query:this.state.query});if(this.refs.input)if(this.refs.input.focusInput)this.refs.input.focusInput();else c("ReactDOM").findDOMNode(this.refs.input).focus()};o.prototype.componentWillReceiveProps=function(p){if(!this.state.viewerEnteredText)this.setState({query:p.query})};o.prototype.render=function(){var p=this.$ChatContentSearchFlyout1(this.state.query);return c("React").createElement("div",{className:"_1er4",onKeyDown:this.$ChatContentSearchFlyout2,role:"presentation"},c("React").createElement("div",{className:"_3mtr"},this.$ChatContentSearchFlyout3()),c("React").createElement("div",{className:"_3mts"},c("React").createElement(c("ChatContentSearchResults.react"),{onResultsLoaded:this.$ChatContentSearchFlyout4,onSelect:this.$ChatContentSearchFlyout5,query:p,searchInterface:this.props.searchInterface}),c("React").createElement(c("ChatContentSearchTrendingIndicator.react"),{shown:p.length===0})))};o.prototype.$ChatContentSearchFlyout3=function(){var p=this.props.location===c("MercuryShareAttachmentRenderLocations").MESSENGER?c("MessengerSearchInput.react"):c("XUITextInput.react");return c("React").createElement(p,{className:"_4qcs",isFocused:true,onClick:function q(r){return r&&r.stopPropagation()},onChange:this.$ChatContentSearchFlyout6,onClear:function(){this.setState({query:"",viewerEnteredText:false})}.bind(this),placeholder:i._("Search GIFs across apps..."),ref:"input",value:this.state.query||""})};o.propTypes={location:l.oneOf(c("MercuryShareAttachmentRenderLocations").getValues()),onEscKeyDown:l.func,onSelect:l.func.isRequired,query:l.string,searchInterface:l.oneOf([c("MessengerPlatformInterfaceType").UNKNOWN_INTERFACE,c("MessengerPlatformInterfaceType").FB_INTERFACE,c("MessengerPlatformInterfaceType").FB_POST_INTERFACE,c("MessengerPlatformInterfaceType").MESSENGER_INTERFACE])};f.exports=o}),null);
__d("ReactComposerGIFToggleController.react",["cx","Arbiter","ContextualLayerAutoFlip","LayerTabIsolation","React","ReactComposerContextTypes","ReactComposerEvents","ReactComposerTaggerActions","ReactComposerTaggerType","MessengerPlatformInterfaceType","ChatContentSearchFlyout.react","XUIContextualDialog.react","ReactComposerScrapedAttachmentActions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("React").PureComponent);j=i&&i.prototype;function k(){__p&&__p();var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.$ReactComposerGIFToggleController1=function(){c("ReactComposerTaggerActions").selectTagger(this.context.composerID,this.props.loggingName,c("ReactComposerTaggerType").GIF,false)}.bind(this),this.$ReactComposerGIFToggleController3=function(){if(this.props.showFlyout)c("ReactComposerTaggerActions").deselectCurrentTagger(this.context.composerID,this.props.loggingName)}.bind(this),this.$ReactComposerGIFToggleController4=function(q){c("ReactComposerScrapedAttachmentActions").scrapeAttachment(this.context.composerID,this.context.targetID,q.source.url,this.context.composerType,this.context.actorID,this.props.loggingName);c("ReactComposerTaggerActions").setTaggerData(this.context.composerID,this.props.loggingName,c("ReactComposerTaggerType").GIF,{gifData:{url:q.source.url}});this.$ReactComposerGIFToggleController3();c("Arbiter").inform(c("ReactComposerEvents").ACTIVATE_ATTACHMENT+this.context.composerID)}.bind(this),m}k.prototype.render=function(){return c("React").createElement("span",{onClick:this.props.onClick||this.$ReactComposerGIFToggleController1,role:"presentation"},c("React").createElement("span",{className:this.props.spanClassName,ref:"container"},this.props.children),this.$ReactComposerGIFToggleController2())};k.prototype.$ReactComposerGIFToggleController2=function(){if(!this.props.showFlyout)return null;return c("React").createElement(c("XUIContextualDialog.react"),{alignment:this.props.alignment||"left",behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),LayerTabIsolation:c("LayerTabIsolation")},contextRef:function(){return this.refs.container}.bind(this),onBlur:this.props.onBlur||this.$ReactComposerGIFToggleController3,onToggle:function(l){if(!l&&this.props.showFlyout)this.props.onBlur&&this.props.onBlur()||this.$ReactComposerGIFToggleController3()}.bind(this),position:"below",shown:this.props.showFlyout,hasActionableContext:true,width:278},c("React").createElement("div",null,c("React").createElement(c("ChatContentSearchFlyout.react"),{onEscKeyDown:this.props.onBlur||this.$ReactComposerGIFToggleController3,onSelect:this.props.onSelect||this.$ReactComposerGIFToggleController4,searchInterface:c("MessengerPlatformInterfaceType").FB_POST_INTERFACE,shown:this.props.showFlyout})))};k.contextTypes=c("ReactComposerContextTypes");f.exports=k}),null);
__d("ReactComposerGIFSproutContainer.react",["cx","FluxContainer","React","ReactComposerContextTypes","ReactComposerSproutItem.react","ReactComposerDisabledSproutItem.react","ReactComposerSproutsDefaultUIConfig","ReactComposerGIFToggleController.react","ReactComposerTaggerStore","ReactComposerScrapedAttachmentStore","ReactComposerMediaUploadStore","ReactComposerTaggerType","ExtensibleSproutsItemType"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("React").PureComponent);j=i&&i.prototype;k.getStores=function(){return[c("ReactComposerTaggerStore"),c("ReactComposerScrapedAttachmentStore"),c("ReactComposerMediaUploadStore")]};k.calculateState=function(l,m,n){var o=n.composerID;return{highlighted:c("ReactComposerTaggerStore").hasData(o,c("ReactComposerTaggerType").GIF),isDisabled:c("ReactComposerTaggerStore").isDisabled(o,c("ReactComposerTaggerType").GIF),isSelected:c("ReactComposerTaggerStore").getSelectedTagger(o)===c("ReactComposerTaggerType").GIF}};k.prototype.render=function(){if(this.state.isDisabled)return c("React").createElement(c("ReactComposerDisabledSproutItem.react"),{uiConfig:this.props.uiConfig});return c("React").createElement(c("ReactComposerGIFToggleController.react"),babelHelpers["extends"]({},this.props,{showFlyout:this.state.isSelected,spanClassName:"_4mvf",loggingName:this.props.uiConfig.loggingName}),c("React").createElement(c("ReactComposerSproutItem.react"),{uiConfig:this.props.uiConfig,highlighted:this.state.highlighted}))};function k(){i.apply(this,arguments)}k.defaultProps={uiConfig:c("ReactComposerSproutsDefaultUIConfig")[c("ExtensibleSproutsItemType").GIF]};k.contextTypes=c("ReactComposerContextTypes");f.exports=c("FluxContainer").create(k,{withContext:true,withProps:true})}),null);
__d("ReactComposerMediaSproutContainer.react",["ReactComposerAttachmentStore","ReactComposerAttachmentType","ReactComposerMediaSprout.react","ReactComposerMediaUploadStore","ReactComposerContextTypes","FluxContainer","React"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("React").PureComponent);i=h&&h.prototype;j.getStores=function(){return[c("ReactComposerAttachmentStore"),c("ReactComposerMediaUploadStore")]};j.calculateState=function(k,l,m){var n=c("ReactComposerAttachmentStore").getIsAttachmentSelected(m.composerID,c("ReactComposerAttachmentType").MEDIA),o=c("ReactComposerMediaUploadStore").getUploadsCount(m.composerID);return{highlighted:!!o&&n}};j.prototype.render=function(){return c("React").createElement(c("ReactComposerMediaSprout.react"),babelHelpers["extends"]({config:this.props.config},this.props,this.state))};function j(){h.apply(this,arguments)}j.contextTypes=c("ReactComposerContextTypes");f.exports=c("FluxContainer").create(j,{withContext:true,withProps:true})}),null);
__d("ReactComposerRecommendationsSproutContainer.react",["ReactComposerAttachmentActions","ReactComposerAttachmentStore","ReactComposerAttachmentType","ReactComposerTaggerStore","ReactComposerTaggerType","ReactComposerContextTypes","ReactComposerStore","ReactComposerSproutItem.react","ReactComposerDisabledSproutItem.react","ReactComposerSproutsDefaultUIConfig","ExtensibleSproutsItemType","FluxContainer","React","ShimButton.react"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("React").PureComponent);i=h&&h.prototype;function j(){var k,l;for(var m=arguments.length,n=Array(m),o=0;o<m;o++)n[o]=arguments[o];return l=(k=i.constructor).call.apply(k,[this].concat(n)),this.$ReactComposerRecommendationsSproutContainer1=function(p){if(!this.state.isSelected)c("ReactComposerAttachmentActions").selectAttachment(this.context.composerID,c("ReactComposerAttachmentType").PLACE_LIST,true,c("ExtensibleSproutsItemType").RECOMMENDATION,c("ReactComposerStore").getSproutSurface(this.context.composerID))}.bind(this),l}j.getStores=function(){return[c("ReactComposerAttachmentStore"),c("ReactComposerTaggerStore")]};j.calculateState=function(k,l,m){var n=c("ReactComposerAttachmentStore").getSelectedAttachmentID(m.composerID),o=n===c("ReactComposerAttachmentType").PLACE_LIST;return{isSelected:o,isDisabled:c("ReactComposerTaggerStore").isDisabled(m.composerID,c("ReactComposerTaggerType").RECOMMENDATION)}};j.prototype.render=function(){if(this.state.isDisabled)return c("React").createElement(c("ReactComposerDisabledSproutItem.react"),{uiConfig:this.props.uiConfig});return c("React").createElement(c("ShimButton.react"),{onClick:this.$ReactComposerRecommendationsSproutContainer1},c("React").createElement(c("ReactComposerSproutItem.react"),{uiConfig:this.props.uiConfig,highlighted:this.state.isSelected}))};j.defaultProps={uiConfig:c("ReactComposerSproutsDefaultUIConfig")[c("ExtensibleSproutsItemType").RECOMMENDATION]};j.contextTypes=c("ReactComposerContextTypes");f.exports=c("FluxContainer").create(j,{withContext:true,withProps:true})}),null);
__d("ReactComposerTagEventSproutContainer.react",["React","ReactComposerSproutsDefaultUIConfig","ReactComposerTaggerSproutContainer.react","ReactComposerTaggerType","ExtensibleSproutsItemType"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("React").PureComponent);i=h&&h.prototype;j.prototype.render=function(){return c("React").createElement(c("ReactComposerTaggerSproutContainer.react"),{uiConfig:this.props.uiConfig,taggerID:c("ReactComposerTaggerType").TAG_EVENT})};function j(){h.apply(this,arguments)}j.defaultProps={uiConfig:c("ReactComposerSproutsDefaultUIConfig")[c("ExtensibleSproutsItemType").TAG_EVENT]};f.exports=j}),null);